<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Submitted Signatures</title>
    <style>
      /* your existing CSS… */
      .card { margin: 1em 0; padding: .5em; border: 1px solid #ccc; display: flex; align-items: center; }
      .card img { margin-right: 1em; }
      .download-btn { margin-left: auto; }
    </style>
  </head>
  <body>
    <h1>Submitted Signatures</h1>
    <div id="status">Loading…</div>
    <div id="grid"></div>

    <!-- 1) Pull in Supabase UMD bundle -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

    <!-- 2) Then your own script -->
    <script>
      // ← your real values here
      const SUPABASE_URL = 'https://feidochrncyejojvmxog.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5…(anon public key)…';

      // don’t overwrite the global `supabase`—use a different name
      const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      const statusEl = document.getElementById('status');
      const gridEl   = document.getElementById('grid');

      async function loadSignatures() {
        try {
          const { data: rows, error } = await client
            .from('signatures')
            .select('customer_id, inserted_at, signature_data')
            .order('inserted_at', { ascending: false });

          if (error) throw error;
          if (!rows.length) {
            statusEl.textContent = 'No signatures submitted yet.';
            return;
          }
          statusEl.style.display = 'none';

          rows.forEach(row => {
            const card = document.createElement('div');
            card.className = 'card';

            // thumbnail
            const img = document.createElement('img');
            img.src = row.signature_data;
            img.width = 120;
            img.height = 60;
            card.appendChild(img);

            // info
            const info = document.createElement('div');
            info.innerHTML = `
              <p><strong>ID:</strong> ${row.customer_id}</p>
              <p><strong>Time:</strong> ${new Date(row.inserted_at).toLocaleString()}</p>
            `;
            card.appendChild(info);

            // download button
            const btn = document.createElement('button');
            btn.textContent = 'Download';
            btn.className = 'download-btn';
            btn.onclick = () => {
              const a = document.createElement('a');
              a.href = row.signature_data;
              const safeId = row.customer_id.replace(/[^a-z0-9_\-]/gi, '_');
              a.download = `sig_${safeId}_${Date.now()}.png`;
              a.click();
            };
            card.appendChild(btn);

            gridEl.appendChild(card);
          });
        } catch (err) {
          statusEl.textContent = 'Error loading data: ' + err.message;
        }
      }

      loadSignatures();
    </script>
  </body>
</html>
