<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Submitted Signatures</title>
  <style>
    body {
      max-width:800px;
      margin:2rem auto;
      font-family:Arial,sans-serif;
      line-height:1.5;
    }
    h1 {
      text-align:center;
    }
    .entry {
      border:1px solid #ccc;
      padding:1rem;
      margin-bottom:1rem;
      position:relative;
    }
    .entry img {
      max-height:120px;
      display:block;
      margin-bottom:0.5rem;
    }
    .entry .info {
      margin-bottom:0.5rem;
    }
    .entry button {
      position:absolute;
      top:1rem;
      right:1rem;
      padding:0.4rem 0.8rem;
    }
    #status {
      text-align:center;
      margin-top:2rem;
      font-weight:bold;
    }
  </style>
</head>
<body>

  <h1>Submitted Signatures</h1>
  <div id="status">Loading…</div>
  <div id="list"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // —— Supabase 客户端初始化 —— 
    const SUPABASE_URL  = 'https://feidochrncyejojvmxog.supabase.co';
    const SUPABASE_ANON = 'sb_publishable_zGi43MB9RNuhAWJ5f-O68A_nLK9HT7u';
    const supabase      = createClient(SUPABASE_URL, SUPABASE_ANON);

    const statusEl = document.getElementById('status');
    const listEl   = document.getElementById('list');

    async function loadEntries() {
      statusEl.textContent = 'Loading…';
      try {
        const { data, error } = await supabase
          .from('signatures')
          .select('*')
          .order('inserted_at', { ascending: false });

        if (error) throw error;
        if (!data || data.length === 0) {
          statusEl.textContent = 'No entries found.';
          return;
        }
        statusEl.style.display = 'none';

        // 渲染每条记录
        data.forEach(row => {
          const div = document.createElement('div');
          div.className = 'entry';

          // 签名图
          const img = document.createElement('img');
          img.src = row.signature_data;
          img.alt = 'Signature';
          div.appendChild(img);

          // 下载按钮
          const btn = document.createElement('button');
          btn.textContent = 'Download';
          btn.addEventListener('click', () => {
            const a = document.createElement('a');
            a.href = row.signature_data;
            a.download = `${row.full_name || 'signature'}-${row.inserted_at}.png`;
            a.click();
          });
          div.appendChild(btn);

          // 信息列表
          const info = document.createElement('div');
          info.className = 'info';
          info.innerHTML = `
            <strong>Full Name:</strong> ${row.full_name || ''}<br>
            <strong>Date of Birth:</strong> ${row.date_of_birth || ''}<br>
            <strong>Mobile Number:</strong> ${row.mobile || ''}<br>
            <strong>Email Address:</strong> ${row.email || ''}<br>
            <strong>Account opening amount:</strong> ${row.opening_amount || ''}<br>
            <strong>Occupation:</strong> ${row.occupation || ''}<br>
            <strong>Residential Address:</strong> ${row.residential_address || ''}<br>
            <strong>Time:</strong> ${new Date(row.inserted_at).toLocaleString()}
          `;
          div.appendChild(info);

          listEl.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error loading data: ' + err.message;
      }
    }

    window.addEventListener('DOMContentLoaded', loadEntries);
  </script>
</body>
</html>
