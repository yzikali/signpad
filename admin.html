<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Signature Admin</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: sans-serif;
      background: #f5f5f5;
    }

    h1 {
      text-align: center;
      margin-bottom: 16px;
    }

    #status {
      text-align: center;
      margin-bottom: 16px;
      color: #666;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
    }

    .card {
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .card img {
      width: 100%;
      display: block;
    }

    .card .info {
      padding: 8px;
      font-size: 14px;
      color: #333;
      line-height: 1.4;
    }

    .card .info p {
      margin: 4px 0;
    }
  </style>
</head>

<body>

  <h1>Submitted Signatures</h1>
  <div id="status">Loading…</div>
  <div id="grid"></div>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script>
    (async () => {
      // —— 填上你自己的项目信息 —— 
      const SUPABASE_URL = 'https://feidochrnceyjojvnxog.supabase.co';
      const SUPABASE_ANON = 'sb_publishable_zGi43MB9RNuhAWJ5f-O68A_nLK9HT7u';
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

      const statusEl = document.getElementById('status');
      const gridEl = document.getElementById('grid');

      try {
        // 1) 从 signatures 表里拉取所有记录，按最新排前面
        const {data: rows, error} = await supabase
          .from('signatures')
          .select('customer_id, path, inserted_at')
          .order('inserted_at', {ascending: false});

        if (error) throw error;
        if (!rows.length) {
          statusEl.textContent = 'No signatures submitted yet.';
          return;
        }

        statusEl.style.display = 'none';

        // 2) 遍历渲染
        for (let row of rows) {
          // 根据存储路径获取公开 URL
          const {data: {publicUrl}, error: urlErr} = supabase
            .storage
            .from('signatures')
            .getPublicUrl(row.path);
          if (urlErr) {
            console.error('getPublicUrl error', urlErr);
            continue;
          }

          const card = document.createElement('div');
          card.className = 'card';

          const img = document.createElement('img');
          img.src = publicUrl;
          card.appendChild(img);

          const info = document.createElement('div');
          info.className = 'info';
          info.innerHTML = `
          <p><strong>ID:</strong> ${row.customer_id}</p>
          <p><strong>Time:</strong> ${new Date(row.inserted_at).toLocaleString()}</p>
        `;
          card.appendChild(info);

          gridEl.appendChild(card);
        }

      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error loading data: ' + err.message;
      }
    })();
  </script>
</body>

</html>